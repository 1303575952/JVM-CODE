## 如何判断一个数是否在40亿个整数中？

![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJDATwbyX2tdKHaXXIQEKaiaiat8ecAhBa5whFdiaQbUCjI7HBuv3bTvsyA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

作者

channingbreeze

如需转载，请联系原作者授权。



小史是一个应届生，虽然学的是电子专业，但是自己业余时间看了很多互联网与编程方面的书，一心想进BAT。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJDATwbyX2tdKHaXXIQEKaiaiat8ecAhBa5whFdiaQbUCjI7HBuv3bTvsyA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



今天他就去BAT中的一家面试了。



简单的自我介绍后，面试官给了小史一个问题。



**【面试现场】**



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJyXXtu6DLNAh12tnL1xeeFwO3MqALadPXvWVY2ooto3GAIS1vlKwp6A/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJmfcIwr54XhCocvX2KicFfuqlCtrUXXbEYejdQaIFI3Hp5iaQqJFwiccqA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



**题目：我有40亿个整数，再给一个新的整数，我需要判断新的整数是否在40亿个整数中，你会怎么做？**



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJW8qiblPsXtog0hqTBl8T97wuxibyHkIqpJJbicTC81vMbj3PUQWAHmqZg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJErlQZY7jjZicxNnXahQoQjIwibQicbgKmCG5nQIwADgOFD1OgyDmic6Kkw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJiaISIFnAAW5eSnkPTibsAicgl0GBFCkickIibuS1n2QoZ2nTLCSxvuw8mrw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJNQQezib0zjLic79dfBbLhu3GrlFeEZQonPmj1MNO7uy2w8WtrSfqRwLg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJlPRibrCmOPj5cuuS7CPsMKz4GK514naeItHgKugYX7gFLmws7AicZfAw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJSvZERibpwCxNj1tVg9JMBhQFgmxu9wECO4tanrhUm1rGh3QHLn2cibww/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJrtH58me3fB5GN5cBjaY8jGDWnUE8SvQibEQ3l5e5aGruB0fwBMJicCag/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJRtPJqX2U6vke021wSTtVofKjhr1jTqzAN4tB1v50LXzHtAd5AALLgA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJiaEo620icTZGh1sVU1BWgB4ic4ZtQQbibGudl18iamrFhHUKP9oK6j5ad5g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJIibqZTLdJkxP7ibpyalWcJMR5oiabtd3gj72aFmm9cym1pncrRWRpMOTA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJVoia4ic3nARH2OqeBBoNicP9YkP5cjBHPPYuHnAQnrTlH14BJMjvkCZeA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



**【请教大神】**



小史回到学校，把面试的情况和计算机学院的吕老师说了一下。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJ0B2wUL1CrhnCmdIMjz7XYuTTVl4galltQIJaBV0jXlhkuIY08uPpkQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJfaqv6Am4GtNP1Xib6EibGJpoQibOWB9WW2jULefXssdiadFW65DpoLPGSA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



小史忙拉着吕老师问，为什么我说分8次加载数据，面试官会说太慢了呢？



吕老师：哈哈，从磁盘加载数据是磁盘io操作，是非常慢的，你每次都要加载这么大的数据，还要8次，我估计你找一个数的时间可以达到分钟甚至小时级了。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJenhicdMRrr2icoTiahTsfY8KHPiaULQm8ibA7glUVDtd6Oo86icAYyDAYbzw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



小史：那如果是你，你会怎么办呢？



吕老师：其实面试官已经提示得比较明显了，他说给你一批机器，就是暗示你可以用分布式算法。你把数据分散在8台机器上，然后来一个新的数据，8台机器一起找，最后再汇总结果就行了。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJ6vIKxJeibQlRQto0N0gmWLfFq9ruNYQHOXECutEDGS2Xibicspj1z73nw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



小史：这样的话能快多少？



吕老师：这样应该能达到秒级。小史，你可以自己分析分析。



小史：我想想……哦，这样做的话，因为每台机器都可以一次性把数据读入内存，在比较的时候不用来回加载数据了，所以可以节省加载数据的开销！这真是个好办法。



**【更好方案】**



吕老师：其实这并不是最好方法，我这还有一种毫秒级的方法，想不想知道啊？



小史：当然想啊，快教教我。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJkUOwd3ME81oA9kYSkD0R9gJncV9ndtibTs7HXUPYKqmf7PK7gp8nWfA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



小史：哦，对哦，这样我就申请40亿个位就好了，新的数转换成一个位，然后判断一下这个位是0还是1就行了。



吕老师：小史啊，考虑问题要考虑清楚啊，如果是40亿个位，那么这40亿个位哪些是0，哪些是1呢？来了一个新的数，怎么判断是否在40亿个位之中？



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJPoq7Z0WFrIdV98G3cfmiagiaC89Q0iaZtTcbICiaTvicLib1mYzj6hjy3zRg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



小史：我想想，对啊，40亿个位，40亿个数，那么每个位都是1，这。。。



吕老师：其实你可以想想，32位int的范围，总共就是2的32次方，大概42亿多点。所以你可以申请2的32次方个位。



小史：意思是我把整个整数范围都覆盖了，哦，对哦。这样一来，就可以做了，1代表第一个位，2代表第二个位，2的32次方代表最后一个位。40亿个数中，存在的数就在相应的位置1，其他位就是0。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJIYXg1aviclPE1Fg2PwGsficmgF7Kibowg09Da4TAoLpwYtJ6lv6icECvWw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)





吕老师：没错，那来了一个新的数呢？



小史：新的数就去找相应的位，比如来了一个1234，就找一下第1234位，如果是1就存在，是0就不存在啦。



吕老师：没错，那么这样的话，需要多大内存呢？



小史：我想想啊，2的32次方个位，相当于2的29次方个字节，哇，才500MB，真是节省了不少内存呢。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJkibHc3JzumRcno07CYn7wblfAIUsI9s5wRWb1ymL45nPkEiceqJf4Cow/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



小史：这么厉害的算法，你是怎么想到的？



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJvibwI3DkKvicibkUCn6qIeHicZaGhu2sjUT5HKlMTlMwCohccaYerLhv4w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



吕老师：其实这是一种非常有名的大数据算法，叫位图法，英文名叫bitmap。顾名思义，就是用位来表示状态，从而节省空间。明天正好我有一节课，就讲位图法，你可以来听一听。



**【吕老师的课】**



第二天，吕老师开始上课，他一开始就抛出了小史遇到的面试题。



吕老师：同学们，这道题是BAT公司的一道面试题，大家有什么思路吗？



话音刚落，蛋哥就站起来回答。蛋哥是吕老师最得意的门生，以思维活跃著称。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJpBbnuODFVmRN4ZpJszm70ibQr50Lmac0KkSibKh3ReTS6W3axn7iav7icw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



蛋哥：我觉得可以这样。首先，32位int的范围是42亿，40亿整数中肯定有一些是连续的，我们可以先对数据进行一个外部排序，然后用一个初始的数和一个长度构成一个数据结构，来表示一段连续的数，举个例子。

如果数据是1 2 3 4 6 7……这种的，那么可以用(1,4)和(6,2)来表示，这样一来，连续的数都变成了2个数表示。

来了一个新数之后，就用二分法进行查找了。

这样一来，最差情况就是2亿多的断点，也就是2亿多的结构体，每个结构体8个字节，大概16亿字节，1.6GB，在内存中可以放下。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/1hReHaqafafoECOhLn7Aek9lmuTfPzZJ9U9969s5c8Av7XHRrvict99msfkN8xDn8tVHDb4oNbr9a2TqVVvrmSA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



吕老师：嗯，非常好，不仅给出了方案，还能主动分析空间和可行性。



小史听完后深感佩服，问题的解决方法绝对不止一种，只要肯动脑筋，即使没有学过bitmap算法，也能有别的方法来解决问题。

